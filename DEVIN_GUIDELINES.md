# Devin向けガイドライン

このドキュメントはAIエージェント「Devin」がこのリポジトリで作業する際の詳細なガイドラインです。

## 📋 目次
- [🚨 緊急時クイックリファレンス](#-緊急時クイックリファレンス)
- [📊 データ更新ワークフロー](#-データ更新ワークフロー)
- [🔍 Xアカウント発見ガイド](#-xアカウント発見ガイド)
- [🚀 PR作成・管理](#-pr作成管理)
- [⚠️ よくある間違いと対策](#️-よくある間違いと対策)
- [🤝 コラボレーション](#-コラボレーション)

---

## 🚨 緊急時クイックリファレンス

### 必須チェックリスト（データ更新時）
```bash
# ✅ JSONファイル更新後の必須3点セット
□ 1. JSONファイル更新 (data/processed/)
□ 2. python scripts/generate_viewer_data.py  # ビューアデータ生成
□ 3. python scripts/validate_data.py         # データ検証
□ 4. README.md手動更新:
     - 市町村別の表のX登録数
     - 最終更新日（現在の日付）
     - 統計サマリーの総X登録議員数と割合
```

### 🔥 重要な制約
- ❌ **40自治体を一度に処理しない** → ✅ 2-3自治体でテスト
- ❌ **5,000行超のPR作成禁止** → ✅ 500行以内で分割
- ❌ **人間確認なしの大量更新禁止** → ✅ 10件区切りでレビュー

### ⚡ よく使うコマンド
```bash
# データ検証
python scripts/validate_data.py

# 統計確認
python -c "
import json, os
total_members = total_x = 0
for root, dirs, files in os.walk('data/processed'):
    for file in files:
        if file.endswith('.json') and file.startswith('議員リスト'):
            with open(os.path.join(root, file), 'r') as f:
                data = json.load(f)
                if data:
                    total_members += len(data)
                    total_x += sum(1 for member in data if member.get('X（旧Twitter）'))
print(f'総議員数: {total_members}名, X登録: {total_x}名 ({total_x/total_members*100:.1f}%)')
"

# ブランチ作成
git checkout -b devin/$(date +%s)-{feature-name}
```

---

## 📊 データ更新ワークフロー

### 🎯 データ更新の3点セット（最重要）
JSONファイルを更新した場合、**必ず以下の3つを全て更新**してください：

1. **JSONファイル** (`data/processed/`)
2. **ビューアデータ** (`viewer/js/data.js` - 自動生成可能)
3. **README.md** (統計情報と各市町村の表)

⚠️ **過去の問題例**: PR #73でJSONファイルとビューアデータは更新されましたが、README.mdの更新が漏れていました。

### 📋 作業フローのベストプラクティス

#### 1. 段階的アプローチ
- ❌ **避けるべき**: 40自治体分のデータを一度に処理
- ✅ **推奨**: 2-3自治体でテスト → レビュー → 段階的に拡大

#### 2. PRの適切な分割
- ❌ **避けるべき**: 5,000行を超える巨大なPR
- ✅ **推奨**: 
  - 機能追加とデータ更新は別PR
  - 1つのPRは500行以内を目安
  - レビュアーが理解しやすい単位で分割

#### 3. コミットメッセージ
```bash
# ✅ 良い例
git commit -m "小金井市の議員Xアカウント7件を追加、README.md更新"

# ❌ 悪い例
git commit -m "Update files"  # 具体性がない
```

---

## 🔍 Xアカウント発見ガイド

### 🎯 信頼性確認チェックリスト
発見したXアカウントは以下を確認してください：

```
□ プロフィールに議員であることが明記されているか
□ 自治体名が記載されているか
□ 最近の投稿が議会活動に関連しているか
□ フォロワーに他の議員や自治体公式アカウントがいるか
```

### ⚠️ 疑わしいケースの扱い
確信が持てない場合は：
1. コメントに `/* 要確認 */` を追加
2. PRの説明に懸念事項を記載
3. 人間のレビューを明示的に要求

### 🤖 自動化ツールの使用ルール
```python
# Seleniumなど自動化ツール使用時の必須事項
1. 過度なリクエストを避ける（1アカウントあたり2-3秒の間隔）
2. エラーハンドリングを適切に実装
3. ログを詳細に記録
4. 手動確認用のレポートを生成
```

---

### 📊 統計情報の更新方法

#### README.mdの統計更新スクリプト
```python
# 正確な集計方法
import json
import os

total_members = 0
total_x = 0

for root, dirs, files in os.walk('data/processed'):
    for file in files:
        if file.endswith('.json') and file.startswith('議員リスト'):
            with open(os.path.join(root, file), 'r') as f:
                data = json.load(f)
                if data:  # 空ファイルをスキップ
                    total_members += len(data)
                    total_x += sum(1 for member in data if member.get('X（旧Twitter）'))

print(f'総議員数: {total_members}名')
print(f'X登録議員数: {total_x}名（{total_x/total_members*100:.1f}%）')
```

---

## 🚀 PR作成・管理

### 📝 PR作成時のテンプレート
```markdown
## 概要
[変更内容の簡潔な説明]

## 変更詳細
- [ ] 対象自治体：○○市
- [ ] 追加/更新したXアカウント数：○件
- [ ] README.md更新：完了
- [ ] データ検証：パス

## テスト結果
```bash
$ python scripts/validate_data.py
[結果をペースト]
```

## 確認事項
- [ ] 全てのXアカウントが本人のものか確認済み
- [ ] ビューアで正しく表示されることを確認
- [ ] 統計情報が正確に更新されている

## スクリーンショット
[必要に応じて]
```

### 🔧 新機能追加時のガイドライン

#### 1. 事前相談
大規模な機能追加前に：
- Issueを作成して設計を説明
- 実装方針について意見を求める
- 段階的な実装計画を提示

#### 2. テスト
- ユニットテストを追加
- 既存のテストが全てパスすることを確認
- エッジケースを考慮

#### 3. ドキュメント
- 新機能の使い方をREADMEかdocs/に記載
- コード内にコメントを適切に追加
- 複雑なロジックは図解を検討

---

## ⚠️ よくある間違いと対策

### 🔥 頻出エラーパターン

#### 1. データの不整合
- **❌ 問題**: JSONは更新したがREADME.mdを忘れる
- **✅ 対策**: [緊急時クイックリファレンス](#-緊急時クイックリファレンス)の3点セットチェックリストを必ず実行

#### 2. 過度な自動化
- **❌ 問題**: 人間の確認なしに大量のデータを更新
- **✅ 対策**: バッチ処理は10件程度で区切り、レビューを挟む

#### 3. エラーハンドリング不足
- **❌ 問題**: スクリプトが途中で失敗してもわからない
- **✅ 対策**: try-except、ログ出力、進捗表示を実装

### 🚨 緊急時の対処法
```bash
# データ不整合が発生した場合
1. git status で変更ファイルを確認
2. python scripts/validate_data.py でエラー箇所を特定
3. 3点セットチェックリストを再実行
4. 必要に応じてgit resetで巻き戻し
```

---

## 🤝 コラボレーション

### 👥 Claude CodeとDevinの役割分担
- **Claude Code**: メイン作業者（新自治体追加、日常更新、統計管理）
- **Devin（私）**: 補助的役割（効率化、自動化システム構築、段階的改善）

### 💬 コミュニケーション原則
1. **質問歓迎**: 不明な点は積極的に質問する
2. **段階的実装**: 小さく始めて、フィードバックを受ける
3. **品質重視**: 速度より正確性を優先
4. **レビュー歓迎**: 建設的なフィードバックを活用

### 📚 関連ドキュメント
- `docs/AI_GUIDE.md`: AI向け編集ガイド
- `CLAUDE.md`: Claude Code専用指示書
- `README.md`: プロジェクト全体概要

---

## 🔄 FAQ（よくある質問）

**Q: JSONファイルを更新したが、ビューアに反映されない**
A: [緊急時クイックリファレンス](#-緊急時クイックリファレンス)の3点セットを確認。特に`python scripts/generate_viewer_data.py`の実行を忘れがち。

**Q: 大量のXアカウントを一度に追加したい**
A: ❌ 禁止。2-3自治体でテスト → レビュー → 段階的拡大の原則を守る。

**Q: PRが大きくなりすぎた**
A: 500行を超える場合は分割。機能追加とデータ更新は別PRにする。

---

💡 **このガイドラインは随時更新されます。提案や改善点があれば、Issueで議論しましょう。**
